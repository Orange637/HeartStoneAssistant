var cardsData={cardRarity:{legendary:"传说",epic:"史诗",rare:"稀有",common:"普通",free:"基本"},cardClass:{neutral:"中立",druid:"德鲁伊",hunter:"猎人",mage:"法师",paladin:"圣骑士",priest:"牧师",rogue:"潜行者",shaman:"萨满",warlock:"术士",warrior:"战士"},cardType:{minion:"随从",spell:"法术",weapon:"武器"},cardRace:{murloc:"鱼人",demon:"恶魔",beast:"野兽",dragon:"龙",pirate:"海盗",mechs:"机械"},cardSet:{basic:"基本级",expert:"专家级",missions:"奖励",reward:"纪念",naxx:"纳克萨玛斯",gvg:"地精大战侏儒",brm:"黑石山的火焰"},cardEffect:{battlecry:"战吼",combo:"连击",divine_shield:"圣盾",overload:"过载",silence:"沉默",taunt:"嘲讽",spell_damage:"法术伤害",charge:"冲锋",death_rattle:"亡语",enrage:"激怒",secret:"奥秘",stealth:"潜行",windfury:"风怒",choice:"抉择"}},Cards={init:function(){this.getCardsInit(),this.filter.init(),this.setSearch(),this.tabsHandle(),this.setPagerHandle(),this.goldenHandle(),this.cardsHandle(),CardsBuilder.init()},flashInit:function(){Common.isIOS()?($("#flash_coming h3").show(),$("#flash_coming .tag_coming").css("display","block")):Common.addFlash("http://hearthstone.nos.netease.com/3/cards/coming.swf","flash_coming",250,500)},filter:{init:function(){this.setSelect(),this.setRarity()},setSelect:function(){var a=$("#cards_filter"),b=$(".type",a),c=$(".type_select li",a),d=$("#cards_filter li > a[rel]");b.click(function(){$(this).find(".type_select").toggle()}),b.mouseleave(function(){$(this).find(".type_select").hide()}),c.click(function(){var b=$(this).attr("rel");return $(".cards_option[rel="+b+"]",a).show().siblings().hide(),$(".type_select",a).hide(),Cards.setTypeInit(),!1}),c.hover(function(){$(this).addClass("active")},function(){$(this).removeClass("active")}),d.click(function(){var b=$(this),c=b.attr("rel");if(!b.find("span[class$=_active]").length){Cards.setTabsInit();var d=""==c?b.children().eq(0).attr("class"):b.attr("class"),e=d.lastIndexOf("_"),f=d.substring(e+1),g=Cards.getCurrentParams;if("undefined"==typeof g)var g={};switch(f){case"cost":g.cost=c,delete g.attack,delete g.health;break;case"atk":g.attack=c,delete g.cost,delete g.health;break;case"hp":g.health=c,delete g.attack,delete g.cost}g.cardClass=Cards.getCurrentTab();var h=Cards.getCurrentRarity();g.cardRarity=h,g.golden=Cards.isGolden()?1:0,Cards.getCardsData(g);var i='<span class="type_icon type_'+f+'_active"></span>';return $(".type_"+f+"_active",a).remove(),b.append(i),!1}})},setRarity:function(){{var a=$("#cards_rarity"),b=$("li[rel]",a);$(".rarity_type",a),$("li[rel].active",a)}b.click(function(){var a=$(this),b=a.attr("rel"),c=Cards.getCurrentParams;if("undefined"==typeof c)var c={};if(a.hasClass("active"))return void a.siblings().toggle();if(Cards.setTabsInit(),a.addClass("active").siblings().removeClass("active"),""==b){if(1==a.parent().find("li:visible").length)return void a.siblings().toggle()}else a.siblings().toggle();c.cardRarity=a.attr("rel");var d=Cards.getCurrentType();return c[d[0]]=d[1],c.cardClass=Cards.getCurrentTab(),c.golden=Cards.isGolden()?1:0,Cards.getCardsData(c),!1})}},isObjectNull:function(a){var b=0;for(var c in a)b++;return 0==b?!0:!1},getCardsInit:function(){var a=$(".tabs_hero"),b=$("li",a);$(".tab_tag",a).remove(),$(".cards_null").remove(),b.show(),$("li[rel='druid']").addClass("active").siblings().removeClass("active"),b.each(function(a,b){$(b).data("hasLook",1)});var c=({cardClass:"druid",golden:0,t:(new Date).getTime()},{cards:[{artist:"Richard Wright",background:"“把月火术拖到每一个技能栏位上。”——《如何成为一名德鲁伊》，第五章，第三节",cardClass:"druid",cardEffect:"",cardRarity:"free",cardSet:"basic",cardType:"spell",code:"Moonfire",cost:0,description:"造成1点伤害。",golden:0,id:564,imageUrl:"http://hearthstone.nos.netease.com/1/cards/druid/Moonfire.png",name:"月火术"},{artist:"Doug Alexander",background:"有些德鲁伊做梦的时候都会被陌生人的“给我个激活！”的喊叫声惊醒。",cardClass:"druid",cardEffect:"",cardRarity:"free",cardSet:"basic",cardType:"spell",code:"Innervate",cost:0,description:"仅在本回合中，获得2个法力水晶。",golden:0,id:565,imageUrl:"http://hearthstone.nos.netease.com/1/cards/druid/Innervate.png",name:"激活"},{artist:"Dany Orizio",background:"是去是留，谁去谁留，都由爪子决定。",cardClass:"druid",cardEffect:"",cardRarity:"free",cardSet:"basic",cardType:"spell",code:"Claw",cost:1,description:"使你的英雄获得2点护甲值，并在本回合中获得+2攻击力。",golden:0,id:590,imageUrl:"http://hearthstone.nos.netease.com/1/cards/druid/Claw.png",name:"爪击"},{artist:"Leo Che",background:"他们为什么要咆哮？没人能够确切地作出解释。也许是出于对当前状态下体型的不满？也许并非如此。",cardClass:"druid",cardEffect:"",cardRarity:"common",cardSet:"expert",cardType:"spell",code:"Naturalize",consume:40,cost:1,description:"消灭一个随从，你的对手抽两张牌。",gain:5,golden:0,id:2,imageUrl:"http://hearthstone.nos.netease.com/1/cards/druid/Naturalize.png",name:"自然平衡"},{artist:"Dave Rapoza",background:"确实有些德鲁伊野性十足，但仍有些喜欢在恬静的时刻品上一壶好茶。",cardClass:"druid",cardEffect:"",cardRarity:"rare",cardSet:"expert",cardType:"spell",code:"Savagery",consume:100,cost:1,description:"对一个随从造成等同于你的英雄攻击力的伤害。",gain:20,golden:0,id:5,imageUrl:"http://hearthstone.nos.netease.com/1/cards/druid/Savagery.png",name:"野蛮之击"},{artist:"Raymond Swanland",background:"棘齿城酒馆里的人们纷纷表示，这张牌太强了，应该是传说级别的。",cardClass:"druid",cardEffect:"choice",cardRarity:"common",cardSet:"expert",cardType:"spell",code:"Wrath",consume:40,cost:2,description:"抉择：对一个随从造成3点伤害；或者造成1点伤害并抽一张牌。",gain:5,golden:0,id:6,imageUrl:"http://hearthstone.nos.netease.com/1/cards/druid/Wrath.png",name:"愤怒"},{artist:"Eva Widermann",background:"它真是太可爱了！哦我的天呐，它为什么要咬我的脸？",cardClass:"druid",cardEffect:"taunt,choice",cardRarity:"common",cardSet:"gvg",cardType:"minion",code:"Anodized Robo Cub",cost:2,description:"嘲讽，抉择： +1攻击力；或者+1生命值。",golden:0,id:867,imageUrl:"http://hearthstone.nos.netease.com/1/cards/druid/Anodized+Robo+Cub.png",name:"电镀机械熊仔"},{artist:"Steve Tappin",background:"在灰谷的树林中，猎豹的毛皮漆黑油亮，数量众多。那为什么这地方要叫灰谷，而不是黑谷呢？",cardClass:"druid",cardEffect:"choice",cardRarity:"common",cardSet:"expert",cardType:"spell",code:"Power of the Wild",consume:40,cost:2,description:"抉择：使你的随从获得+1/+1；或者召唤一个3/2的猎豹。",gain:5,golden:0,id:8,imageUrl:"http://hearthstone.nos.netease.com/1/cards/druid/Power+of+the+Wild.png",name:"野性之力"}],curPage:1,pageSize:8,total:25,totalPage:4}),d={curPage:c.curPage,pageSize:c.pageSize,total:c.total,totalPage:c.totalPage},e=c.cards;Cards.setCards(e),Cards.setCardClass("druid"),Cards.setPager(d,"druid")},getCardsData:function(a,b){if(!Cards.getIng){if(Cards.getIng=!0,"undefined"==typeof a)var a={};a.t=(new Date).getTime(),a.token=Common.getToken(),b||(a.p=1),$("#cards_box").append('<img class="imgload" src="http://hearthstone.nos.netease.com/3/cards/cards_loading.gif"/>'),$.post("/cards/query",a,function(c){Cards.getIng=!1,$("#cards_box > .imgload").remove();var d={curPage:c.curPage,pageSize:c.pageSize,total:c.total,totalPage:c.totalPage},e=c.cards,f=c.curCardClass,g=c.totalPerClass;if(CardsBuilder.isStart&&e.length&&a.cardClass!=f){if("neutral"==a.cardClass)return void Cards.setNull();var h=Cards.getCurrentParams;if("undefined"==typeof h)var h={};h.cardClass="neutral";var i=Cards.getCurrentType();h[i[0]]=i[1];var j=Cards.getCurrentRarity();h.cardRarity=j,h.golden=Cards.isGolden()?1:0,Cards.getCardsData(h)}return!e.length&&Cards.isObjectNull(g)?void Cards.setNull():($(".cards_null").remove(),Cards.setCards(e,b),Cards.setTabs(f,g),Cards.setCardClass(f),void Cards.setPager(d,f))},"json")}},setPager:function(a){{var b=$("#cards_page strong");$(".cards_next"),$(".cards_prev")}b.text(a.curPage).attr("data-total",a.totalPage),this.setPagerArrow(a.curPage,a.totalPage)},setPagerHandle:function(){var a=$("#cards_page strong"),b=$(".cards_prev"),c=$(".cards_next");Cards.animated=!1,b.click(function(){if(!Cards.animated){var b=parseInt(a.text()),c=parseInt(a.attr("data-total"));return 1==b?!1:(b--,a.text(b),Cards.setPagerArrow(b,c),Cards.setPagerScroll("prev"),!1)}}),c.click(function(){if(!Cards.animated){var b=parseInt(a.text()),c=parseInt(a.attr("data-total")),d=$("#cards_box .cards_box_wraper");if(b==c)return!1;if(b<d.length)return b++,a.text(b),Cards.setPagerScroll("next"),Cards.setPagerArrow(b,c),!1;var e=Cards.getCurrentParams;if("undefined"==typeof e)var e={};e.cardClass=Cards.getCurrentTab(),e.p=b+1;var f=Cards.getCurrentType();e[f[0]]=f[1];var g=Cards.getCurrentRarity();return e.cardRarity=g,e.golden=Cards.isGolden()?1:0,Cards.setPagerArrow(e.p,c),Cards.getCardsData(e,"next"),!1}})},setPagerScroll:function(a){var b=$("#cards_box"),c=$(".cards_box_border",b),d=parseInt(c.css("left"));if(Cards.animated=!0,"next"==a){var e=d+-762;c.animate({left:e+"px"},800,function(){Cards.animated=!1})}else{var e=d+762;c.animate({left:e+"px"},800,function(){Cards.animated=!1})}},setPagerArrow:function(a,b){var c=$(".cards_prev"),d=$(".cards_next");0==b?(d.hide(),c.hide(),pageTag.text(0)):1==a&&b>1?(c.hide(),d.show()):a==b&&1==b?(c.hide(),d.hide()):a>1&&b>a?(c.show(),d.show()):(c.show(),d.hide())},setCardClass:function(a){var b=$("#cards_data h3"),a=this.getName(a,"cardClass");b.text(a)},setTabs:function(a,b){if("undefined"!=typeof a&&"undefined"!=typeof b){var c=$(".tabs_hero"),d=$("li",c);if(CardsBuilder.isStart&&$("#cards_group:visible").length){var e=0,f=0;d.hide();var g=CardsBuilder.getGroupCls();for(var h in b)h==g&&(e=1),"neutral"==h&&(f=1);return 1==e?$("li[rel="+g+"]",c).show():$("li[rel="+g+"]",c).hide(),1==f?$("li[rel='neutral']",c).show():$("li[rel='neutral']",c).hide(),void $("li[rel="+a+"]",c).addClass("active").siblings().removeClass("active")}$("li[rel="+a+"]").addClass("active").siblings().removeClass("active"),d.hide();for(var h in b){var i=$("li[rel="+h+"]");i.show(),i.data("hasLook")||i.append('<span class="tab_tag">'+b[h]+"</span>")}}},setTabsInit:function(){var a=$(".tabs_hero"),b=$("li",a);b.each(function(a,b){$(b).data("hasLook",0)})},setTypeInit:function(){var a=$("#cards_filter .cards_option:visible"),b=$("span[class$='_active']",a);b.remove()},setParamsInit:function(){this.setTypeInit(),$("#cards_rarity .rarity_type").show().siblings().removeClass("active").hide(),$(".goldenCheck span").removeClass("active")},setNull:function(){var a=$("#cards_data"),b=$(".tabs_hero li",a),c=$("h3",a),d=$("#cards_page strong"),e=$(".cards_next"),f=$(".cards_prev"),g='<p class="cards_null">没有查询结果</p>';b.hide(),c.html("&nbsp;"),a.append(g),e.hide(),f.hide(),d.text(0),$(".cards_box_wraper").html("")},getCurrentTab:function(){var a=$(".tabs_hero"),b=$("li.active",a).attr("rel");return b},getCurrentRarity:function(){var a=$("#cards_rarity"),b=$("li.active",a).attr("rel");return b},getCurrentType:function(){var a=$("#cards_filter .cards_option:visible"),b=$("span[class$='_active']",a);if(!b.length)return[];var c=b.parent(),d=c.attr("rel"),e=""==d?c.children().eq(0).attr("class"):c.attr("class"),f=e.lastIndexOf("_"),g=e.substring(f+1);switch(g){case"cost":g="cost";break;case"atk":g="attack";break;case"hp":g="health"}return[g,d]},isGolden:function(){var a=$(".goldenCheck"),b=a.find("span").attr("class");return"active"==b?!0:!1},goldenHandle:function(){var a=$(".goldenCheck");a.click(function(){var a=$(this);a.find("span").toggleClass("active"),Cards.setTabsInit();var b=Cards.getCurrentParams;if("undefined"==typeof b)var b={};var c=Cards.getCurrentType();b[c[0]]=c[1];var d=Cards.getCurrentRarity();return b.cardRarity=d,b.cardClass=Cards.getCurrentTab(),b.golden=Cards.isGolden()?1:0,Cards.getCardsData(b),!1})},tabsHandle:function(){var a=$(".tabs_hero"),b=$("li",a);b.click(function(){var a=$(this),b=a.attr("rel");if(a.find(".tab_tag").remove(),a.data("hasLook",1),a.hasClass("active"))return!1;var c=Cards.getCurrentParams;if("undefined"==typeof c)var c={};c.cardClass=b;var d=Cards.getCurrentType();c[d[0]]=d[1];var e=Cards.getCurrentRarity();c.cardRarity=e,a.addClass("active").siblings().removeClass("active"),c.golden=Cards.isGolden()?1:0,Cards.getCardsData(c),Cards.setCardClass(b)})},setCards:function(a,b){var c={},d=$("#cards_box");c.cards=a;var e=["{@each cards as item}",'<div class="cards_place">','<a class="cards_link" data-id="${item.id}" data-params="${item.cardClass},${item.code},${item.id},${item.cost},${item.golden}" href="javascript:void(0);" rel="${item.imageUrl}"><img class="imgload" src="http://hearthstone.nos.netease.com/3/cards/cards_loading.gif"/><img class="card_img" alt="${item.name}" src="${item.imageUrl}"/></a>','<div class="cards_detail_wraper">','<div class="cards_detail">','<p class="detail_top">${item.name}</p>','<div class="detail_con">',"<ul>",'<li class="detail_skill">${item.description}</li>','<li>卡牌类型：${item.cardType|formatToC,"cardType"}</li>','<li>职业：${item.cardClass|formatToC,"cardClass"}</li>','{@if item.cardRace && item.cardRace!="other"}','<li>种族：${item.cardRace|formatToC,"cardRace"}</li>',"{@/if}","{@if item.gain}",'<li>分解获得：${item.gain}<span class="icon_stive icon_gain"></span></li>','<li>合成需要：${item.consume}<span class="icon_stive icon_consume"></span></li>',"{@/if}","</ul>",'<p class="border_db"></p>','<p class="detail_bg">${item.background}</p>','<p class="border_db"></p>',"</div>",'<div class="detail_bottom">','<p class="rarity_txt">${item.cardSet|formatToC,"cardSet"}</p>','<p class="rarity_con">${item.cardRarity|formatToC,"cardRarity"}<span class="detail_rarity_icon rarity_${item.cardRarity}"></span></p>','<p class="rarity_artist">画家：${item.artist}</p>',"</div>","</div>","</div>",'<a class="cards_zoom" rel="${item.imageUrl}" href="javascript:void(0);" {@if item.cardType =="spell"}style="bottom:0;"{@/if}></a>',"</div>","{@/each}"].join("");juicer.register("formatToC",Cards.getName);var f=juicer(e,c);if("undefined"==typeof b)$(".cards_box_border",d).html('<div class="cards_box_wraper clearFix">'+f+"</div>").css("left",0);else if("prev"==b)Cards.setPagerScroll(b);else{var g=$("#cards_page strong"),h=parseInt(g.text()),i=$(".cards_box_wraper",d).length;i>h?Cards.setPagerScroll(b):(Cards.setPagerScroll(b),$(".cards_box_border",d).append('<div class="cards_box_wraper clearFix">'+f+"</div>"))}$(".cards_place img.card_img",d).imgpreload({each:function(){$(this).show().prev().hide()}})},cardsHandle:function(){{var a=$("#cards_box .cards_place"),b=$(".cards_link",a);$(".cards_zoom",a)}b.live("click",function(){var a=$(this).next().html(),b=$(this).attr("rel"),c="http://hearthstone.nos.netease.com/1/l-cards/"+b.split("http://hearthstone.nos.netease.com/1/")[1],d='<p class="cards_big"><img class="imgload" src="http://hearthstone.nos.netease.com/3/cards/cards_loading.gif"/><img class="big_img" width="300" src="'+c+'" alt=""/></p>',e='<a class="cards_big_close" href="javascript:void(0);"><span class="btn_fork"></span>关闭</a>',f='<div class="cards_big_box clearFix">'+d+a+"</div>"+e;if(CardsBuilder.isStart){var g=$(this).attr("data-params").split(","),h={cls:g[0],name:g[1],id:g[2],cost:g[3],golden:g[4]};CardsBuilder.addCards(h)}else $.sc2.lightBox(f,{model:!0,hasClose:!1}),$(".cards_big img.big_img").imgpreload(function(){$(this).show().prev().hide()})}),$(".cards_big_close").live("click",function(){$("#popBox").remove(),$("#boxModel").remove()})},setTooltip:function(a,b,c){$("#titleTip").length&&$("#titleTip").remove();var d="<div id='titleTip' style='width:"+a+"px'>"+b+"</div>";$("body").append(d);var e,f,g=c.pageX,h=c.pageY,i=$("#titleTip").width(),j=$("#titleTip").height(),k=$(window).width(),l=$(window).height()+$(window).scrollTop();e=g+i>k?g-(g+i-k)-i:g,f=h+j>l?h-(h+j-l):h,$("#titleTip").css({top:f+"px",left:e+20+"px"}).show("fast").stop(!0,!0)},getName:function(a,b){return cardsData[b][a]},setSearch:function(){var a=$("#cards_search > .cards_btn"),b=$("#cards_search > .search_box"),c=$(".search_tab a",b),d=$(".search_btn .cards_btn",b),e=$(".search_btn .cards_btn_clear",b),f=$(".cards_reset",$("#cards_search")),g=$(".btn_close",b);a.click(function(){b.fadeIn("fast")}),f.click(function(){if(CardsBuilder.isStart)return void CardsBuilder.getClsInit();var a=$(".exact_search .checkboxInput .checked"),b=$(".dim_search input"),c=$(".cards_select_tag");a.removeClass("checked"),b.val(""),c.hide(),Cards.setParamsInit(),Cards.getCardsInit(),Cards.getCurrentParams=void 0}),c.click(function(){var a=$(this).attr("rel");$(this).addClass("active").siblings().removeClass("active"),"exact_search"==a?($(".exact_search",b).show(),$(".dim_search",b).hide()):($(".exact_search",b).hide(),$(".dim_search",b).show())}),g.click(function(a){return a.stopPropagation(),b.hide(),!1}),d.click(function(){var a=$(".search_tab a.active",b).attr("rel"),c=$(".cards_select_tag");if(Cards.setTabsInit(),"exact_search"==a){var d=$(".exact_search .checkboxInput"),e=$("a",d).length,f=$("a.checked",d).length,g={};if(d.each(function(a,b){for(var c=$(b).find("label").attr("rel"),d=$(b).find(".checked"),e=[],f=0,h=d.length;h>f;f++)e.push($(d[f]).attr("rel"));g[c]=e.join(",")}),0==f?c.hide():c.show(),g.golden=0,b.hide(),Cards.setParamsInit(),0==f||f==e)return CardsBuilder.isStart?(CardsBuilder.getClsInit(),void(Cards.getCurrentParams=void 0)):(Cards.getCardsInit(),void(Cards.getCurrentParams=void 0));CardsBuilder.isStart&&(g.cardClass=CardsBuilder.getGroupCls()),Cards.getCardsData(g),Cards.getCurrentParams=g}else{var h=$(".dim_search input").val(),g={};if(g.keywords=h,g.golden=0,b.hide(),Cards.setParamsInit(),""==h||"请输入关键字"==h)return CardsBuilder.isStart?(CardsBuilder.getClsInit(),void(Cards.getCurrentParams=void 0)):(c.hide(),Cards.getCardsInit(),void(Cards.getCurrentParams=void 0));c.show(),CardsBuilder.isStart&&(g.cardClass=CardsBuilder.getGroupCls()),Cards.getCardsData(g),Cards.getCurrentParams=g}return!1}),e.click(function(){var a=$(".search_tab a.active",b).attr("rel"),c=$(".search_option a",b),d=$(".dim_search input");return"exact_search"==a?c.removeClass("checked"):d.val(""),!1})},setGuide:function(){var a=$("#cards_guide"),b=$("img",a),c=$(".btn_guide",a),d=$(".cards_guide_close",a),e=1;if(!$.cookie("CARDS_GUIDE")){a.show();for(var f=[],g=2;5>=g;g++){var h='<img src="http://hearthstone.nos.netease.com/3/cards/guide/'+g+'.jpg"/>';f.push(h)}$("body").append("<div style='display:none'>"+f.join("")+"</div>")}$.cookie("CARDS_GUIDE",1);var i=[{id:1,text:"了解更多",style:"top:50%;left:50%;margin-left:-98px;margin-top: -9px;"},{id:2,text:"下一步",style:"top:50%;left:50%;margin-left:21px;margin-top: -63px;"},{id:3,text:"下一步",style:"top:50%;left:50%;margin-left:-171px;margin-top: 93px;"},{id:4,text:"下一步",style:"top:100%;left:100%;margin-left:-239px;margin-top: -93px;"},{id:5,text:"立即体验",style:"top:50%;left:50%;margin-left:221px;margin-top: -76px;"}];c.click(function(){return 5==e?void a.remove():(c.text(i[e].text).attr("style",i[e].style).removeClass("active"),e++,5==e&&c.addClass("active"),void b.attr("src","http://hearthstone.nos.netease.com/3/cards/guide/"+e+".jpg"))}),d.click(function(){return a.remove(),!1})}},CardsBuilder={init:function(){this.getCardsJson(),this.delCards(),this.builderHandle(),this.saveCards(),this.showCards(),this.searchCards(),this.groupHandle()},getCardsJson:function(){jQuery.ajax({type:"GET",async:!1,url:"http://hearthstone.nos.netease.com/3/json/cards/cards.json",jsonp:"callback",jsonpCallback:"cardsJson",dataType:"jsonp",success:function(a){window.cards_json=a,CardsBuilder.getFromUrl()}})},addCards:function(a){{var b=($("#cards_list"),a.id),c=this.getGroupCls();location.href}if(this.isLongUrl()){if(!this.validateCards(a))return!1;if(!this.validateUrl("trigger"))return!1;this.setUrl(b)}else{if(this.isShortUrl())return CardsBuilder.showBox("不能超过30张卡牌"),!1;location.href="http://"+location.host+"/cards/builder/#"+c+"&"+b+":1"}this.setUrlCards(),this.setScroll(b)},delCards:function(){var a=$("#cards_list > li");a.live("click",function(){var a=$(this),b=a.attr("data-id"),c=(location.href,a.find("span.cards_two")),d=c.length;CardsBuilder.updateUrl(b,"del"),d?c.remove():a.remove(),CardsBuilder.showCost(),CardsBuilder.setScroll()})},showCards:function(){var a=$("#cards_list > li");a.live("mouseover",function(a){var b,c=$(this),d=c.data("id"),e=c.data("cls"),f=cards_json[e][d].name,g=cards_json[e][d].golden;c.addClass("active").siblings().removeClass("active"),b=g?"g-":"",f=f.replace(/[\s:]/g,"+");var h='<img src="http://hearthstone.nos.netease.com/1/'+b+"cards/"+e+"/"+b+f+'.png" alt=""/>';CardsBuilder.setTooltip(168,h,a)}).live("mouseout",function(){$("#cardsTip").remove()}),$("#cardsTip").live("mouseover",function(){$("#cardsTip").remove()})},setTooltip:function(a,b,c){$("#cardsTip").length&&$("#cardsTip").remove();var d="<div id='cardsTip' style='width:"+a+"px'>"+b+"</div>";$("body").append(d);var e,f=(c.pageX,c.pageY),g=($("#cardsTip").width(),$("#cardsTip").height()),h=($(window).width(),$(window).height()+$(window).scrollTop());e=f+g>h?f-(f+g-h):f,$("#cardsTip").css({top:e+"px"}).show("fast").stop(!0,!0)},setScroll:function(){$(".mCustomScrollbar").length?$(".cards_list_wrap").mCustomScrollbar("update"):$("#cards_list img").imgpreload({all:function(){$(".cards_list_wrap").mCustomScrollbar({scrollButtons:{enable:!0},autoDraggerLength:!1})}})},setBuilderTabs:function(){{var a=this.getCardsCls(),b=$(".tabs_hero");$("li",b)}$("li[rel="+a+"]",b).addClass("active").show().siblings().removeClass("active").hide(),$("li[rel='neutral']",b).show()},setUrl:function(a){var b=location.href;times=this.getSelectTimes(a),0==times?location.href=b+";"+a+":1":this.updateUrl(a)},updateUrl:function(a){var b=this.getCardsList(),c=$(".cards_save strong"),d=this.getTotal(),e=[];arguments[1]?(2==b[a]?b[a]=1:delete b[a],c.text(--d)):(c.text(d++),b[a]=2);for(var f in b)e.push(f+":"+b[f]);if(this.isLongUrl()){var g=location.href;g=g.split("&")[0]+"&",location.href=g+e.join(";")}else if(this.isShortUrl()){var h=$("#clazz").val();location.href="http://"+location.host+"/cards/builder/#"+h+"&"+e.join(";")}},updateCards:function(a){var b=$("#cards_list"),c=a.cls,d=a.id,e=$("li[data-id="+d+"]",b),f=a.cost;if(e.length){var g='<span class="thumb_draw cards_two"></span>';e.append(g)}else{var h=this.getImgUrl(d,c);b.append('<li data-cost="'+f+'" data-id="'+d+'" data-cls="'+c+'"><img src="'+h+'" alt=""/><span class="cards_over"></span></li>')}this.showCost()},updateCardsState:function(a,b){var c=$("#cards_box");if("legendary"==b)var d='<span class="cards_disable cards_disable_c"></span>';else var d='<span class="cards_disable"></span>';var e=$(".cards_link[data-id="+a+"]",c);e.find(".cards_disable").length||e.append(d)},validateCards:function(a){var b=a.id,c=this.getCardsCls(),d=a.name,e=this.getTotal();if(e>=30)return CardsBuilder.showBox("不能超过30张卡牌"),!1;if(this.isLongUrl()){var f=this.getCardsList(),g=this.getSelectTimes(b),h=0;if(this.isLegendary(b)){if(1==g)return CardsBuilder.updateCardsState(b,"legendary"),!1}else if(2==g)return CardsBuilder.updateCardsState(b),!1;for(var i in f){var j=cards_json[c][i];if("undefined"==typeof j&&"undefined"==cards_json.neutral[i])return void CardsBuilder.showBox("卡牌地址有误");if("undefined"==typeof j)var k="neutral";else var k=c;if(cards_json[k][i].name==d){var l=parseInt(f[i]);h+=l}}if(this.isLegendary(b)){if(h>=1)return CardsBuilder.updateCardsState(b,"legendary"),!1}else if(h>=2)return CardsBuilder.updateCardsState(b),!1}return!0},validateUrl:function(){var a=(location.href,this.getCardsList()),b=this.getCardsCls(),c=[],d=0,e=0;if("neutral"==b)return void CardsBuilder.showBox("卡牌地址有误");for(var f in a){if(e+=parseInt(a[f]),"undefined"==typeof cards_json[b]||"undefined"==typeof a[f])return void CardsBuilder.showBox("卡牌地址有误");var g=cards_json[b][f];if("undefined"==typeof g&&"undefined"==cards_json.neutral[f])return void CardsBuilder.showBox("卡牌地址有误");var h=a[f];if(CardsBuilder.isLegendary(f)){if(1!=h)return CardsBuilder.showBox("卡牌地址有误"),!1}else if(1!=h&&2!=h)return CardsBuilder.showBox("卡牌地址有误"),!1;if("undefined"==typeof g)var i="neutral";else var i=b;c[d]={},c[d].id=f,c[d].name=cards_json[i][f].name,c[d].num=a[f],d++}if(e>30)return CardsBuilder.showBox("卡牌地址有误"),!1;for(var j,k=0,l=c.length;l>k;k++)for(var m=0,n=c.length;n>m;m++)if(k!=m&&c[k].name==c[m].name)if(j=parseInt(c[k].num)+parseInt(c[m].num),CardsBuilder.isLegendary(c[k].id)){if(j>1)return arguments[0]?CardsBuilder.updateCardsState(c[k].id,"legendary"):CardsBuilder.showBox("卡牌地址有误"),!1}else if(j>2)return arguments[0]?CardsBuilder.updateCardsState(c[k].id):CardsBuilder.showBox("卡牌地址有误"),!1;return!0},showBox:function(a,b){if("custom"==b)var c="<div class='cards_error'>"+a+"</div>";else var c="<p class='cards_error'><span>"+a+"</span></p>";var d=Common.setBoxwrap("300px","100px",c);$.sc2.lightBox(d,{model:!0,hasClose:!1})},selectHero:function(){var a=$("#hero_select"),b=$("a",a);b.mouseover(function(){var a=$(this);b.find(".hero_light").removeClass("hero_active"),a.find(".hero_light").addClass("hero_active")}),b.click(function(){var a=$(this).attr("rel"),b=$(".tabs_hero"),c=$(".exact_search .checkboxInput .checked"),d=$(".dim_search input"),e=$(".cards_select_tag"),b=$(".tabs_hero");CardsBuilder.isStart=!0,Cards.getCurrentParams=void 0,c.removeClass("checked"),d.val(""),e.hide(),$(".tab_tag",b).remove(),Cards.setParamsInit(),CardsBuilder.setGroup(a);var f={cardClass:a,golden:0,p:1};Cards.getCardsData(f),$("#hero_select").hide(),$("#boxModel").remove();var g=$("#cards_selected"),h=$("#cards_group");g.html('<div class="cards_list_wrap"><ul id="cards_list"></ul></div>'),h.show(),$(".cards_save strong").text(0)})},groupHandle:function(){var a,b=$("#cards_group"),c=$("li",b),d=$("#cards_cost"),e=$(".group_close",b);c.live("mouseover",function(){clearTimeout(a),d.show()}).live("mouseout",function(){a=setTimeout(function(){d.hide()},200)}),e.live("click",function(){CardsBuilder.showBox('<p class="cards_confirm_txt">确定要删除卡组吗?</p><p class="cards_confirm"><a rel="confirm" href="javascript:void(0);">确定</a><a rel="cancel" href="javascript:void(0);">取消</a></p>',"custom")}),$(".cards_confirm a").live("click",function(){var a=$(this).attr("rel");"confirm"==a?location.href="http://"+location.host+"/cards/builder/":($("#popBox").remove(),$("#boxModel").remove())})},setGroup:function(a){var b=$("#cards_group"),c=$(".newCards"),d='<span class="name">自定义套牌</span>',e='<span class="thumb_draw group_over"></span>',f='<span class="thumb_draw group_close"></span>',g='<li><a class="group_'+a+'" href="javascript:void(0);">'+d+e+f+"</a></li>";c.hide(),b.append(g),b.show()},saveCards:function(){var a=$("#saveBox"),b=$("#cards_finish"),c=$("#cards_submit");b.click(function(){if(!CardsBuilder.validateUrl())return void CardsBuilder.showBox("卡牌地址有误");var b=$(".group",a),c=$(".name",a),d=$(".checkboxInput a",a),e=$("textarea",a);b.val(""),c.val(""),$.sc2.placeholder({trigger:".group_input input"}),e.val(""),d.removeClass("checked");var f=CardsBuilder.getTotal();return 30>f?!1:void $.sc2.lightBox($("#saveBox"),{model:!0})}),$("textarea",a).keyup(function(){var b=$(this).val();b.length>300&&$("textarea",a).val(b.substring(0,300))}),c.click(function(){var b=$(".group",a).val(),c=$(".name",a).val(),d=$(".checkboxInput .checked",a),e=$("textarea",a).val(),f=[];if(!b)return alert("请填写套牌名称"),!1;if(!d.length)return alert("请选择标签"),!1;var g=d.length;if(g>3)return alert("标签不能超过3个"),!1;if(!e)return alert("请填写套牌描述"),!1;if(e.length>300)return alert("字数限制在300以内"),!1;for(var h=0,i=d.length;i>h;h++){var j=$(d[h]).text();f.push(j)}""==c&&(c="炉石玩家");var k=CardsBuilder.getGroupCls(),l=CardsBuilder.getSaveList();$.post("/deck/save",{deckName:b,creator:c,clazz:k,content:l,tags:f.join(","),description:e,token:Common.getToken(),t:(new Date).getTime()},function(a){if(a.id)CardsBuilder.showSaveTip(a.id);else{var b=a.msg;alert("fail"==b?"保存失败，请重试":"参数不合法")}},"json")})},showSaveTip:function(a){var b=$("#saveBox"),c=$("#saveTip"),d=$("strong",c),e=$(".saveTipNew",c),f=$(".saveTipOld",c);b.hide(),d.text(a),$.sc2.lightBox(c,{model:!0,hasClose:!1}),window.jiathis_config={data_track_clickback:!1,summary:"这是我的新卡组，分享给大家：http://"+location.host+"/cards/builder/"+a+"炉石酒馆中的对战正在激烈进行，如此精彩岂容错过？赶紧加入吧！",pic:"",title:"#炉石传说#",url:"http://"+location.host+"/cards/builder/"+a,shortUrl:!1,hideMore:!1},e.click(function(){location.href="http://"+location.host+"/cards/builder/"}),f.click(function(){c.hide(),$("#boxModel").remove()})},showSaveCon:function(a){if("undefined"==typeof a)var a={deckName:$("#deckName").val(),creator:$("#creator").val(),clazz:$("#clazz").val(),content:$("#content").val(),tags:$("#tags").val(),description:$("#description").val(),createTime:$("#createTime").val()};var b=$("#saveCon"),c=$(".deckName",b),d=$(".creator",b),e=$(".tags",b),f=$(".description",b),g=$(".createTime",b);c.text(a.deckName),d.text(a.creator),e.text(a.tags),f.text(a.description),g.text(a.createTime),$("#cards_group .name").text(a.deckName);var h=$("#saveCon"),i=$(".closeBtn",h);h.show(),i.click(function(){h.hide()})},shareCards:function(){var a=$("#shareNav"),b=location.href,c=$("input",a);c.val(b),c.click(function(){$(this).select()}),c.hover(function(){var a=c.val();$(this).attr("title",a)}),this.updateShareCards()},updateShareCards:function(){var a=$("#shareNav"),b=location.href,c=$("input",a);c.val(b);var d=c.val();window.jiathis_config={data_track_clickback:!1,summary:"这是我的新卡组，分享给大家："+d+"炉石酒馆中的对战正在激烈进行，如此精彩岂容错过？赶紧加入吧！",pic:"",title:"#炉石传说#",url:d,shortUrl:!1,hideMore:!1}},searchCardsPost:function(){var a=$(".cards_uid"),b=$("input",a),c=b.val(),d=/^([0-9]+)$/;return c&&d.test(c)?void(location.href="http://"+location.host+"/cards/builder/"+c):(alert("请输入ID查找套牌"),!1)},setSearchId:function(){var a=$(".cards_uid"),b=$("input",a);b.val(location.href.split("/cards/builder/")[1]),b.addClass("cards_uid_in")},searchCards:function(){var a=$(".cards_uid"),b=$("input",a),c=$("a",a);b.keypress(function(a){13==a.keyCode&&CardsBuilder.searchCardsPost()}),b.focus(function(){var a=$(this),b=a.val();a.hasClass("cards_uid_in")&&(a.val(""),a.removeClass("cards_uid_in")),"请输入ID查找套牌"==b&&$(this).val("")}).blur(function(){var a=$(this).val();""==a&&$(this).val("请输入ID查找套牌")}),c.click(function(){CardsBuilder.searchCardsPost()})},builderHandle:function(){var a=$(".newCards");a.click(function(){$.sc2.lightBox($("#hero_select"),{model:!0})}),this.selectHero()},getSelectTimes:function(a){var b=this.getCardsList(),c=b[a];return c?c:0},getCardsList:function(){var a=location.href;if(this.isLongUrl()){var b=a.split("/builder/#")[1],c=b.split("&")[1];b.split("&")[0]}else if(this.isShortUrl())var c=($("#clazz").val(),$("#content").val());return CardsBuilder.formatCardsList(c)},getSaveList:function(){var a=$("#cards_list"),b=$("li",a),c=[];return b.each(function(a,b){var d=$(b).find("span.cards_two").length,e=$(b).attr("data-id");d=d?2:1,c.push(e+":"+d)}),c.join(";")},getSaveCls:function(){var a=$("#cards_list"),b=$("li:eq(0)",a),c=b.attr("data-cls");return c},formatCardsList:function(a){var b={},c=/^[0-9]+:[1-2]{1}$/;if(a.indexOf(";")>0)var d=a.split(";");else if(c.test(a)){var e=a.split(":")[0],f=a.split(":")[1],g={};return g[e]=f,g}var h=d.length,i=[];if(h>30)return void CardsBuilder.showBox("卡牌有误");for(var j=0,k=h;k>j;j++){var l=d[j].split(":")[0],m=d[j].split(":")[1];b[l]=m,i.push(l)}return this.isRepeatId(i)?void CardsBuilder.showBox("卡牌有误"):b},getCardsCls:function(){var a="";if(this.isShortUrl())var a=$("#clazz").val();else var b=location.href,c=b.split("/builder/#")[1],a=(c.split("&")[1],c.split("&")[0]);return a},getGroupCls:function(){var a=$("#cards_group"),b=$("a",a).attr("class");return b.split("group_")[1]},getClsInit:function(){var a=this.getGroupCls(),b={cardClass:a,golden:0,p:1};Cards.getCardsData(b)},getSearchResult:function(){var a=$(".cards_uid"),b=a.attr("data-content"),c=a.attr("data-cls");return{list:b,cls:c}},getImgUrl:function(a,b){var c=cards_json[b][a].name,d=cards_json[b][a].golden,e="";return c=c.replace(/[\s:]/g,"+"),d&&(e="g-"),"http://hearthstone.nos.netease.com/1/s-cards/"+e+"cards/"+b+"/"+e+c+".png"},getTotal:function(){var a=$(".cards_save strong"),b=parseInt(a.text());return b},isShortUrl:function(){var a=$("#deckName");return a.length?!0:!1},isLongUrl:function(){var a=location.href,b=/^[0-9]+:[1-2]{1}$/;if(a.indexOf("/builder/#")>0){var c=this.getCardsCls();if(c){var d=a.split("/builder/#"+c+"&")[1];if(d){if(b.test(d))return!0;var e=d.split(";")[0];if(e&&b.test(e))return!0}}}return!1},isLegendary:function(a){var b=this.getCardsCls();if("undefined"==typeof cards_json[b][a]){var c="neutral";if("undefined"==typeof cards_json.neutral[a])return void CardsBuilder.showBox("卡牌地址有误")}else var c=b;var d=cards_json[c][a].rarity;
return"legendary"==d?!0:!1},isSearchUrl:function(){var a=$(".cards_uid");return a.attr("data-content")?!0:!1},isRepeatId:function(a){a=a.sort();for(var b=0,c=a.length-1;c>b;b++)if(a[b]==a[b+1])return!0;return!1},getFromUrl:function(){if(CardsBuilder.shareCards(),this.isShortUrl()){var a={clazz:$("#clazz").val(),content:$("#content").val()};CardsBuilder.isStart=!0,CardsBuilder.setUrlCards(),CardsBuilder.setGroup(a.clazz),CardsBuilder.showSaveCon();var b={cardClass:a.clazz,golden:0,p:1};Cards.getCardsData(b),CardsBuilder.setScroll()}else{if(!this.isLongUrl())return;if(this.validateUrl()){CardsBuilder.setBuilderTabs(),CardsBuilder.isStart=!0,CardsBuilder.setUrlCards();var c=CardsBuilder.getCardsCls();CardsBuilder.setGroup(c);var a={cardClass:c,golden:0,p:1};Cards.getCardsData(a),CardsBuilder.setScroll()}}},setUrlCards:function(){if(this.isLongUrl())var a=this.getCardsList(),b=this.getCardsCls();else if(this.isShortUrl()){var c={clazz:$("#clazz").val(),content:$("#content").val()},b=c.clazz,d=c.content,a=this.formatCardsList(d);this.setSearchId()}var e,f=$("#cards_list"),g=[],h=0;for(var i in a){if("undefined"==typeof cards_json[b][i]){var j="neutral";if("undefined"==typeof cards_json.neutral[i])return void CardsBuilder.showBox("卡牌地址有误")}else var j=b;var k=CardsBuilder.getImgUrl(i,j),l=a[i],m=cards_json[j][i].cost,n=cards_json[j][i].name;e=1==l?"":'<span class="thumb_draw cards_two"></span>',g[h]={},g[h].html='<li id="cards_small_'+i+'" data-cost="'+m+'" data-id="'+i+'" data-cls="'+j+'" data-name="'+n+'"><img src="'+k+'" alt=""/><span class="cards_over"></span>'+e+"</li>",g[h].cost=m,h++}for(var o=[],p=0,q=g.length;q>p;p++)o.push(g[p].html);f.html("").append(o.join("")),$("#cards_list > li").tsort({data:"cost"},{data:"name"}),this.showCost()},showCost:function(){var a=$("#cards_list"),b=$("li",a),c=0,d={};b.each(function(a,b){var e,f=$(b).find("span.cards_two").length,g=$(b).attr("data-cost");e=f?2:1,g>7?g=7:"",c+=e;for(var h=0;7>=h;h++)if(g==h){var i=e;d[h]=d[h]?d[h]+i:i}});var e=$("#cards_finish");30==c?e.removeClass("cards_btn_disabled"):e.addClass("cards_btn_disabled"),$(".cards_save strong").text(c),$("#cards_cost .line").css("height",0),$("#cards_cost .num").text(0);$("#cards_cost");for(var f in d){var g=Math.round(d[f]/c*100)+"%";$("li.cost_"+f).html('<span class="line" style="height:'+g+'"><span class="num">'+d[f]+"</span></span>")}this.updateShareCards()}};