var Search={init:function(){this.setSearch()},page_num:10,getTokenOn:function(){$.post("/common/another-token",{current:(new Date).getTime()},function(){})},setSearchPost:function(a,b,c,d){var e=this,f=$(".w-search-more"),g=$(".m-search-list-wrap"),h=$(".w-search-filter a").eq(0),i=$(".j-s-txt"),j=$(".w-search-sort"),k=($(".m-search-tip"),'<img alt="" src="http://hearthstone.nos.netease.com/3/common/loading.gif" class="imgload"/>');"more"!=d&&(g.html(k),f.hide()),$.post("/action/search/query-article",{keyword:a,start:c,sort:b,token:Common.getToken(),t:(new Date).getTime()},function(a){var b=a.numFound,c=a.docs;if($("#total-l").html(b),f.data("total",b),i.show(),j.show(),$.cookie("HS_I",null,{expires:5,path:"/"}),b){b>e.page_num&&f.show().find(".ui-mm").text("显示更多");var k=e.setListHtml(c);"more"==d?g.append(k):(f.attr("data-page",1),g.html(k));var l=f.attr("data-page")*e.page_num;l>=b&&f.hide(),$(".w-search-filter").show(),h.find("span").text("（"+b+"）")}else $(".w-search-filter").hide(),g.html("<p style='padding-top:20px'>未搜索到有关结果</p>"),f.hide(),j.hide(),h.find("span").text("（0）")},"json").error(function(){i.show(),$(".w-search-filter").hide(),g.html("<p style='padding-top:20px'>未搜索到有关结果</p>"),f.hide(),j.hide(),h.find("span").text("（0）")})},setSearch:function(){var a=this,b=$(".w-search-box"),c=$("input",b),d=$("a",b),e=$(".u-search-field"),f=($(".m-search-list-wrap"),$(".w-search-more")),g=$(".w-search-sort a"),h=$(".m-search-tip");c.focus(function(){$(this).attr("data-f",1)}).blur(function(){$(this).attr("data-f",0)}),d.click(function(){var b=$.trim(c.val());return""==b?void alert("请输入搜索内容！"):(e.text(b),h.hide(),a.setSearchPost(b,"",0),void g.eq(0).addClass("f-active").siblings().removeClass("f-active"))}),g.click(function(){var b=$(this),d=b.attr("rel");if(b.hasClass("f-active"))return!1;var f=$.trim(e.text());c.val(f),h.hide(),a.setSearchPost(f,d,0),b.addClass("f-active").siblings().removeClass("f-active")});var i=$.cookie("HS_I");null!=i?(c.val(i),d.trigger("click")):h.show(),f.click(function(){var b=$(this),c=a.page_num,d=(b.data("total"),parseInt(b.attr("data-page"))),f=d+1,g=$.trim(e.text()),h=$(".w-search-sort .f-active").attr("rel"),i=d*c;b.attr("data-page",f),b.find(".ui-mm").text("数据加载中..."),a.setSearchPost(g,h,i,"more")}),$(document).keyup(function(a){if(13==a.keyCode){var b=$.trim(c.val()),e=c.attr("data-f");""!=b&&1==e&&d.trigger("click")}})},setListHtml:function(a){juicer.set({escape:!1});var b={};b.docs=a;var c=["{@each docs as item}",'<div class="w-search-list f-cb">','<a href="/articles/${item.column_id}/${item.id}" target="_blank" class="u-search-img"><img width="112" height="56" alt="" src="{@if !item.thumbnailUrl}http://hearthstone.nos.netease.com/3/search/default.jpg{@else}${item.thumbnailUrl}{@/if}"><span class="mark"></span></a>','<div class="w-search-news">','<h4 class="f-light-blue"><a href="/articles/${item.column_id}/${item.id}" target="_blank">',"{@if item.article_title_hl}","$${item.article_title_hl}","{@else}","$${item.article_title}","{@/if}","</a><span>（${item.comment_sum}条评论）</span></h4>",'<p class="u-search-time">${item.publish_time|formatDate}</p>','<p class="u-search-txt">',"{@if item.article_content_hl}","$${item.article_content_hl}...","{@/if}","</p>","</div>","</div>","{@/each}"].join("");juicer.register("formatDate",Search.formatDate);var d=juicer(c,b);return d},formatDate:function(a){{var b=new Date(a),c=b.getFullYear(),d=b.getMonth()+1,e=b.getDate(),f=b.getHours(),g=b.getMinutes();b.getSeconds()}return 10>g&&(g="0"+g),c+"-"+d+"-"+e+" "+f+":"+g}};